#!/bin/sh

rm -f build.log

# Remove generated files
rm -f config/binary config/bootstrap config/chroot config/common config/source

# remove kanotix-scripts
grep -oe '^[^ #]*' scripts.urls | grep -oe '[^/]*$' | xargs -i rm -f config/chroot_local-includes/usr/local/bin/{}

# Remove empty directories in config tree
if ls config/*/ > /dev/null 2>&1
then
	rmdir --ignore-fail-on-non-empty config/*/
fi

if [ -d config ]
then
	rmdir --ignore-fail-on-non-empty config
fi

# umount tmpfs
if [ -e tmpfs ]; then
       case "$1" in
       --tmpfs|--all)
               [ "$(stat --printf "%d\n" . tmpfs | uniq -u)" ] && umount tmpfs;;
       esac
       [ "$1" = "--tmpfs" ] && exit 1
fi

exit 0
